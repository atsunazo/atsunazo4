<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ひらがな練習</title>
    <style>
        /* スタイルは簡略化しています */
        .hiragana-grid {
            display: flex;
            flex-direction: row-reverse;
            gap: 3px;
            width: calc(100% - 1px);
        }
        .hiragana-column {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex: 1;
        }
        .hiragana-button {
            width: 100%;
            aspect-ratio: 1;
            font-size: 14px;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <header>
        <h1>ひらがな練習</h1>
    </header>
    <main>
        <div id="quiz-container">
            <img id="quiz-image" src="" alt="問題">
        </div>
        <div>
            <input type="text" id="answer-input" placeholder="解答を入力">
            <button id="submit-button">送信</button>
            <button id="back-button">戻る</button>
        </div>
        <div id="error-message"></div>
        <div id="hiragana-grid" class="hiragana-grid"></div>
    </main>
    <footer>
        <p>© 2025 ひらがな練習. All rights reserved.</p>
    </footer>

    <script>
        const hiraganaGrid = [
            ["あ", "い", "う", "え", "お"],
            ["か", "き", "く", "け", "こ"],
            ["さ", "し", "す", "せ", "そ"],
            ["た", "ち", "つ", "て", "と"],
            ["な", "に", "ぬ", "ね", "の"],
            ["は", "ひ", "ふ", "へ", "ほ"],
            ["ま", "み", "む", "め", "も"],
            ["や", "", "ゆ", "", "よ"],
            ["ら", "り", "る", "れ", "ろ"],
            ["わ", "", "", "", "を"],
            ["ん", "゛", "゜", "小", "×"]
        ];

        const dakutenMap = {
            か: "が", き: "ぎ", く: "ぐ", け: "げ", こ: "ご",
            さ: "ざ", し: "じ", す: "ず", せ: "ぜ", そ: "ぞ",
            た: "だ", ち: "ぢ", つ: "づ", て: "で", と: "ど",
            は: "ば", ひ: "び", ふ: "ぶ", へ: "べ", ほ: "ぼ"
        };

        const handakutenMap = {
            は: "ぱ", ひ: "ぴ", ふ: "ぷ", へ: "ぺ", ほ: "ぽ"
        };

        const smallMap = {
            つ: "っ", や: "ゃ", ゆ: "ゅ", よ: "ょ",
            あ: "ぁ", い: "ぃ", う: "ぅ", え: "ぇ", お: "ぉ"
        };

        let currentQuestionId = 1;
        let isSubmitting = false;

        function initializeHiraganaGrid() {
            const gridContainer = document.getElementById('hiragana-grid');
            hiraganaGrid.forEach(column => {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'hiragana-column';
                column.forEach(char => {
                    const button = document.createElement('button');
                    button.className = 'hiragana-button';
                    button.textContent = char;
                    button.onclick = () => handleCharacterClick(char);
                    columnDiv.appendChild(button);
                });
                gridContainer.appendChild(columnDiv);
            });
        }

        function handleCharacterClick(char) {
            const answerInput = document.getElementById('answer-input');
            if (char === "×") {
                answerInput.value = answerInput.value.slice(0, -1);
            } else if (char === "゛" || char === "゜" || char === "小") {
                const lastChar = answerInput.value.slice(-1);
                if (char === "゛" && dakutenMap[lastChar]) {
                    answerInput.value = answerInput.value.slice(0, -1) + dakutenMap[lastChar];
                } else if (char === "゜" && handakutenMap[lastChar]) {
                    answerInput.value = answerInput.value.slice(0, -1) + handakutenMap[lastChar];
                } else if (char === "小" && smallMap[lastChar]) {
                    answerInput.value = answerInput.value.slice(0, -1) + smallMap[lastChar];
                }
            } else if (char !== "") {
                answerInput.value += char;
            }
        }

        function handleSubmit() {
            if (isSubmitting) return;
            isSubmitting = true;
            const answerInput = document.getElementById('answer-input');
            const currentAnswer = answerInput.value;
            answerInput.value = "";
            // ここで解答を送信する処理を実装します
            console.log("解答を送信:", currentAnswer);
            isSubmitting = false;
        }

        function handleBack() {
            if (currentQuestionId > 1 && !isSubmitting) {
                currentQuestionId--;
                updateQuizImage();
            }
        }

        function updateQuizImage() {
            const quizImage = document.getElementById('quiz-image');
            quizImage.src = `quiz${currentQuestionId}.png`;
            quizImage.alt = `問題 ${currentQuestionId}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeHiraganaGrid();
            updateQuizImage();
            document.getElementById('submit-button').addEventListener('click', handleSubmit);
            document.getElementById('back-button').addEventListener('click', handleBack);
        });
    </script>
</body>
</html>
